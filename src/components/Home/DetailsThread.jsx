import React, {useState} from 'react';
import DetailsThreadServer from "./DetailsThreadServer";
import {useApi} from "../../hooks/useApi";
import ModalDist from "../Modal/ModalDist";
import EmptyPage from "../EmptyPage";
import {Empty} from "antd";

const DetailsThread = ({serversControl, threadsControl, thread, modalConfirm, alertControl}) => {
    const [changeSentThread, changeSentThreadIsLoading] = useApi({
        method: 'POST',
        url: `/profile-monitoring-system/settings/${thread.id}/change`,
        data: {...thread, isActive: !thread.isActive},
    });

    const [modalDistIsOpen, setModalDistIsOpen] = useState(false);
    const modalDistControl = {get: modalDistIsOpen, set: setModalDistIsOpen};

    return (
        <div className={"details__thread" + (thread.isActive ? '' : ' disable')}>
            <div className="details__thread-header">
                <div className="details__thread-header-icon">
                    <img src={thread.settingsTypeIconLink} alt="" />
                </div>
                <p className="details__thread-header-name"><span>{thread.name}</span></p>
                <div className="details__thread-info-box">
                    <p className={"details__thread-header-item type" + (thread.isSendingCopies ? ' copy' : '')}>
                        {thread.isSendingCopies ?
                        <>
                            <span>Копирование</span>
                            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M14.5273 3.6674L10.1323 1.7099C9.48727 1.4249 8.51227 1.4249 7.86727 1.7099L3.47227 3.6674C2.36227 4.1624 2.19727 4.8374 2.19727 5.1974C2.19727 5.5574 2.36227 6.23241 3.47227 6.72741L7.86727 8.68491C8.18977 8.8274 8.59477 8.9024 8.99977 8.9024C9.40477 8.9024 9.80977 8.8274 10.1323 8.68491L14.5273 6.72741C15.6373 6.23241 15.8023 5.5574 15.8023 5.1974C15.8023 4.8374 15.6448 4.1624 14.5273 3.6674Z" fill="#A1B1C5"/>
                                <path d="M8.1474 12.6531L8.1474 12.6531L8.14804 12.6534C8.41659 12.7685 8.70828 12.8299 9.00023 12.8299C9.2921 12.8299 9.58398 12.7685 9.84542 12.6532L9.84557 12.6531L14.9006 10.4031L14.9006 10.4031C15.2973 10.2259 15.6474 9.89989 15.8981 9.51275C16.1489 9.12562 16.3027 8.67382 16.3027 8.24244C16.3027 7.90732 16.0328 7.63744 15.6977 7.63744C15.3626 7.63744 15.0927 7.90732 15.0927 8.24244C15.0927 8.43626 15.0129 8.65937 14.8852 8.85547C14.7575 9.05158 14.5862 9.21421 14.4101 9.29167L14.4099 9.29176L9.35519 11.5416C9.35515 11.5416 9.35511 11.5417 9.35507 11.5417C9.12791 11.641 8.86505 11.641 8.6379 11.5417C8.63786 11.5417 8.63782 11.5416 8.63778 11.5416L3.58307 9.29176L3.58287 9.29167C3.40699 9.21429 3.23563 9.04994 3.10782 8.85274C2.98001 8.65555 2.90023 8.43243 2.90023 8.24244C2.90023 7.90732 2.63035 7.63744 2.29523 7.63744C1.96012 7.63744 1.69023 7.90732 1.69023 8.24244C1.69023 8.67753 1.84403 9.12934 2.09486 9.51561C2.3457 9.90188 2.69578 10.226 3.09235 10.4031L3.0924 10.4031L8.1474 12.6531Z" fill="#A1B1C5" stroke="#A1B1C5" strokeWidth="0.1"/>
                                <path d="M8.1474 16.3731L8.1474 16.3731L8.14804 16.3734C8.41659 16.4885 8.70828 16.5499 9.00023 16.5499C9.2921 16.5499 9.58398 16.4885 9.84542 16.3732L9.84557 16.3731L14.9006 14.1231L14.9008 14.123C15.751 13.74 16.3027 12.8973 16.3027 11.9624C16.3027 11.6273 16.0328 11.3574 15.6977 11.3574C15.3626 11.3574 15.0927 11.6273 15.0927 11.9624C15.0927 12.4151 14.8194 12.8321 14.4102 13.0116L14.4099 13.0117L9.35519 15.2616C9.35515 15.2616 9.35511 15.2616 9.35507 15.2617C9.12791 15.361 8.86505 15.361 8.6379 15.2617C8.63786 15.2616 8.63782 15.2616 8.63778 15.2616L3.58319 13.0118C3.58316 13.0118 3.58312 13.0118 3.58309 13.0117C3.16599 12.8247 2.90023 12.415 2.90023 11.9624C2.90023 11.6273 2.63035 11.3574 2.29523 11.3574C1.96012 11.3574 1.69023 11.6273 1.69023 11.9624C1.69023 12.897 2.24174 13.7475 3.09246 14.1231C3.09249 14.1231 3.09251 14.1231 3.09254 14.1232L8.1474 16.3731Z" fill="#A1B1C5" stroke="#A1B1C5" strokeWidth="0.1"/>
                            </svg>
                        </>
                        :
                        <>
                            <span>Распределение</span>
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M4.81608 5.13332H2.6987C1.92232 5.13332 1.28711 4.55584 1.28711 3.85003V2.56674C1.28711 1.86093 1.92232 1.28345 2.6987 1.28345H4.81608C5.59245 1.28345 6.22767 1.86093 6.22767 2.56674V3.85003C6.22767 4.55584 5.59245 5.13332 4.81608 5.13332Z" fill="#A1B1C5"/>
                                <path d="M14.5577 4.49182H12.0169C11.5511 4.49182 11.1699 4.14533 11.1699 3.72184V2.69521C11.1699 2.27172 11.5511 1.92523 12.0169 1.92523H14.5577C15.0236 1.92523 15.4047 2.27172 15.4047 2.69521V3.72184C15.4047 4.14533 15.0236 4.49182 14.5577 4.49182Z" fill="#A1B1C5"/>
                                <path d="M14.5577 9.30395H12.0169C11.5511 9.30395 11.1699 8.95746 11.1699 8.53397V7.50734C11.1699 7.08385 11.5511 6.73737 12.0169 6.73737H14.5577C15.0236 6.73737 15.4047 7.08385 15.4047 7.50734V8.53397C15.4047 8.95746 15.0236 9.30395 14.5577 9.30395Z" fill="#A1B1C5"/>
                                <path opacity="0.96" d="M11.1662 8.5018C11.4556 8.5018 11.6955 8.28364 11.6955 8.02057C11.6955 7.75749 11.4556 7.53933 11.1662 7.53933H9.22526V3.68946H11.1662C11.4556 3.68946 11.6955 3.4713 11.6955 3.20822C11.6955 2.94515 11.4556 2.72699 11.1662 2.72699H6.22563C5.93626 2.72699 5.69629 2.94515 5.69629 3.20822C5.69629 3.4713 5.93626 3.68946 6.22563 3.68946H8.16657V11.5496C8.16657 12.5249 9.03469 13.3141 10.1075 13.3141H11.1662C11.4556 13.3141 11.6955 13.096 11.6955 12.8329C11.6955 12.5698 11.4556 12.3517 11.1662 12.3517H10.1075C9.6205 12.3517 9.22526 11.9924 9.22526 11.5496V8.5018H11.1662Z" fill="#A1B1C5"/>
                                <path d="M14.5577 14.1163H12.0169C11.5511 14.1163 11.1699 13.7698 11.1699 13.3464V12.3197C11.1699 11.8962 11.5511 11.5497 12.0169 11.5497H14.5577C15.0236 11.5497 15.4047 11.8962 15.4047 12.3197V13.3464C15.4047 13.7698 15.0236 14.1163 14.5577 14.1163Z" fill="#A1B1C5"/>
                            </svg>
                        </>
                        }
                    </p>
                    <p className="details__thread-header-item period">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M16.6338 7.46656C16.0754 6.8499 15.2338 6.49156 14.0671 6.36656V5.73323C14.0671 4.59156 13.5838 3.49156 12.7338 2.7249C11.8754 1.94156 10.7588 1.5749 9.60044 1.68323C7.60877 1.8749 5.93377 3.7999 5.93377 5.88323V6.36656C4.76711 6.49156 3.92544 6.8499 3.36711 7.46656C2.55877 8.36656 2.58377 9.56656 2.67544 10.3999L3.25877 15.0416C3.43377 16.6666 4.09211 18.3332 7.67544 18.3332H12.3254C15.9088 18.3332 16.5671 16.6666 16.7421 15.0499L17.3254 10.3916C17.4171 9.56656 17.4421 8.36656 16.6338 7.46656ZM9.7171 2.84156C10.5504 2.76656 11.3421 3.0249 11.9588 3.58323C12.5671 4.13323 12.9088 4.91656 12.9088 5.73323V6.31656H7.09211V5.88323C7.09211 4.3999 8.31711 2.9749 9.7171 2.84156ZM10.0004 16.4356C7.73015 16.4356 5.88972 14.5952 5.88972 12.3249C5.88972 10.0546 7.73015 8.21418 10.0004 8.21418C12.2707 8.21418 14.1112 10.0546 14.1112 12.3249C14.1112 14.5952 12.2707 16.4356 10.0004 16.4356Z" fill="#A1B1C5"/>
                            <path d="M8.87188 14.2857C8.61176 14.2857 8.35164 14.1536 8.20597 13.9199C7.98747 13.5644 8.10192 13.0869 8.4765 12.8736L9.40253 12.3352V11.238C9.40253 10.8215 9.75629 10.4761 10.1829 10.4761C10.6095 10.4761 10.9528 10.8114 10.9528 11.238V12.7618C10.9528 13.026 10.8072 13.2799 10.5783 13.412L9.27767 14.1739C9.15281 14.245 9.00714 14.2857 8.87188 14.2857Z" fill="#A1B1C5"/>
                        </svg>
                        <span>{thread.sendingPeriod}</span>
                    </p>
                    <p className="details__thread-header-item folder">
                        <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M18.864 10.5887L18.7207 10.3916C18.4699 10.087 18.1742 9.84512 17.8338 9.66596C17.3769 9.40616 16.8574 9.27179 16.3199 9.27179H5.16673C4.62923 9.27179 4.11861 9.40616 3.65278 9.66596C3.3034 9.85408 2.98986 10.1139 2.73007 10.4364C2.21944 11.0903 1.97757 11.8966 2.05819 12.7028L2.38965 16.8864C2.50611 18.1495 2.6584 19.7082 5.49819 19.7082H15.9974C18.8372 19.7082 18.9805 18.1495 19.1059 16.8774L19.4374 12.7118C19.518 11.9593 19.3209 11.2068 18.864 10.5887Z" fill="#FFB74B"/>
                            <path d="M7.92311 14.3105C7.7022 14.3087 7.5217 14.4864 7.51993 14.7073C7.51817 14.9282 7.69583 15.1087 7.91673 15.1105L7.92311 14.3105ZM13.7698 15.04C13.9273 14.885 13.9293 14.6317 13.7743 14.4743L11.2491 11.9085C11.0941 11.751 10.8409 11.749 10.6834 11.904C10.526 12.0589 10.524 12.3122 10.6789 12.4697L12.9236 14.7504L10.6429 16.995C10.4854 17.15 10.4834 17.4032 10.6384 17.5607C10.7933 17.7181 11.0466 17.7201 11.204 17.5652L13.7698 15.04ZM7.91673 15.1105L13.4861 15.1549L13.4924 14.3549L7.92311 14.3105L7.91673 15.1105Z" fill="white"/>
                            <path d="M18.4093 7.61011C18.4514 7.9925 18.0351 8.25087 17.6678 8.13641C17.2414 8.0035 16.7942 7.93704 16.3305 7.93704H5.16839C4.6998 7.93704 4.23799 8.00829 3.80385 8.14451C3.4411 8.25833 3.02734 8.00961 3.02734 7.62943V5.96621C3.02734 2.76808 4.0038 1.79163 7.20193 1.79163H8.25901C9.54005 1.79163 9.94318 2.20371 10.4628 2.87558L11.5378 4.30892C11.7617 4.6135 11.7707 4.63142 12.1648 4.63142H14.2969C17.0601 4.63142 18.162 5.36182 18.4093 7.61011Z" fill="#FFB74B"/>
                        </svg>
                        <span>{thread.folderForReading}</span>
                    </p>
                    <button type="button"
                            className={"details__thread-btn switch-btn" + (thread.isActive ? ' active' : ' disable')}
                            onClick={(e) => {
                                e.stopPropagation();
                                modalConfirm.set({
                                    style: thread.isActive ? 'red' : 'green',
                                    titleText: <>{thread.isActive ? 'Выключить' : 'Включить'} отправку по настройке <b>{thread.name}?</b></>,
                                    btnText: thread.isActive ? 'Да, выключить' : 'Да, включить',
                                    onConfirm: () => {
                                        changeSentThread().then((resp) => {
                                            modalConfirm.close();

                                            if (resp.status === 'SUCCESS') {
                                                alertControl.set({text: 'Отправка успешно ' + (thread.isActive ? 'выключена' : 'включена'), type: 'success', open: true});
                                                threadsControl.set(threadsControl.get.map((item) => {
                                                    if (item.id === thread.id) {
                                                        return {...item, isActive: !thread.isActive}
                                                    }
                                                    return item
                                                }));

                                                let isActiveThreads = false;
                                                threadsControl.get.forEach((item) => {
                                                    if (item.id === thread.id) item.isActive = !item.isActive;
                                                    if (item.isActive) isActiveThreads = true;
                                                });
                                                serversControl.set(serversControl.get.map((item) => {
                                                    if (item.id === thread.server.id) {
                                                        return {...item, isSentActive: isActiveThreads}
                                                    }
                                                    return item
                                                }));
                                            } else {
                                                alertControl.set({text: resp.error.description, type: 'error', open: true});
                                            }
                                        });
                                    },
                                    open: true})
                            }}
                    />
                </div>
                <div className="details__folder-info-box">
                    <span className="details__forder-text">Копирование профилей внутри:</span>
                    <div className={"details__folder-dist" + (thread.folderDistribution ? ' hasDistribution' : '')}>
                        <button className="details__folder-btn send">
                            <svg width="24" height="21" viewBox="0 0 24 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path fillRule="evenodd" clipRule="evenodd" d="M0.5274 0.520889C-5.96046e-08 1.04178 0 1.87911 0 3.55556C0 5.232 -5.96046e-08 6.06933 0.5274 6.59022C1.0548 7.11111 1.9026 7.11111 3.6 7.11111H14.4C16.0974 7.11111 16.9452 7.11111 17.4726 6.59022C18 6.06933 18 5.232 18 3.55556C18 1.87911 18 1.04178 17.4726 0.520889C16.9452 -5.96046e-08 16.0974 0 14.4 0H3.6C1.9026 0 1.0548 -5.96046e-08 0.5274 0.520889ZM6.3 5.11111C6.12098 5.11111 5.94929 5.04087 5.8227 4.91585C5.69612 4.79082 5.625 4.62126 5.625 4.44444V2.66667C5.625 2.48986 5.69612 2.32029 5.8227 2.19526C5.94929 2.07024 6.12098 2 6.3 2C6.47902 2 6.65071 2.07024 6.7773 2.19526C6.90388 2.32029 6.975 2.48986 6.975 2.66667V4.44444C6.975 4.62126 6.90388 4.79082 6.7773 4.91585C6.65071 5.04087 6.47902 5.11111 6.3 5.11111ZM10.35 2.88889C10.171 2.88889 9.99929 2.95913 9.8727 3.08415C9.74612 3.20918 9.675 3.37874 9.675 3.55556C9.675 3.73237 9.74612 3.90194 9.8727 4.02696C9.99929 4.15198 10.171 4.22222 10.35 4.22222H14.4C14.579 4.22222 14.7507 4.15198 14.8773 4.02696C15.0039 3.90194 15.075 3.73237 15.075 3.55556C15.075 3.37874 15.0039 3.20918 14.8773 3.08415C14.7507 2.95913 14.579 2.88889 14.4 2.88889H10.35ZM3.6 5.11111C3.42098 5.11111 3.24929 5.04087 3.1227 4.91585C2.99612 4.79082 2.925 4.62126 2.925 4.44444V2.66667C2.925 2.48986 2.99612 2.32029 3.1227 2.19526C3.24929 2.07024 3.42098 2 3.6 2C3.77902 2 3.95071 2.07024 4.0773 2.19526C4.20388 2.32029 4.275 2.48986 4.275 2.66667V4.44444C4.275 4.62126 4.20388 4.79082 4.0773 4.91585C3.95071 5.04087 3.77902 5.11111 3.6 5.11111ZM0.5274 9.40978C-5.96046e-08 9.93067 0 10.768 0 12.4444C0 14.1209 -5.96046e-08 14.9582 0.5274 15.4791C1.0548 16 1.9026 16 3.6 16H14.4C16.0974 16 16.9452 16 17.4726 15.4791C18 14.9582 18 14.1209 18 12.4444C18 10.768 18 9.93067 17.4726 9.40978C16.9452 8.88889 16.0974 8.88889 14.4 8.88889H3.6C1.9026 8.88889 1.0548 8.88889 0.5274 9.40978ZM2.925 13.3333C2.925 13.5101 2.99612 13.6797 3.1227 13.8047C3.24929 13.9298 3.42098 14 3.6 14C3.77902 14 3.95071 13.9298 4.0773 13.8047C4.20388 13.6797 4.275 13.5101 4.275 13.3333V11.5556C4.275 11.3787 4.20388 11.2092 4.0773 11.0842C3.95071 10.9591 3.77902 10.8889 3.6 10.8889C3.42098 10.8889 3.24929 10.9591 3.1227 11.0842C2.99612 11.2092 2.925 11.3787 2.925 11.5556V13.3333ZM6.3 14C6.12098 14 5.94929 13.9298 5.8227 13.8047C5.69612 13.6797 5.625 13.5101 5.625 13.3333V11.5556C5.625 11.3787 5.69612 11.2092 5.8227 11.0842C5.94929 10.9591 6.12098 10.8889 6.3 10.8889C6.47902 10.8889 6.65071 10.9591 6.7773 11.0842C6.90388 11.2092 6.975 11.3787 6.975 11.5556V13.3333C6.975 13.5101 6.90388 13.6797 6.7773 13.8047C6.65071 13.9298 6.47902 14 6.3 14Z" fill="#78C33B"/>
                                <circle cx="16" cy="13" r="8" fill="white"/>
                                <path d="M20.8002 13C20.8002 15.6531 18.6533 17.8 16.0002 17.8C13.3471 17.8 11.7325 15.1295 11.7325 15.1295M11.7325 15.1295H13.8969M11.7325 15.1295V17.5295M11.2002 13C11.2002 10.3469 13.3297 8.20001 16.0002 8.20001C19.2031 8.20001 20.8002 10.8706 20.8002 10.8706M20.8002 10.8706V8.47056M20.8002 10.8706H18.6707" stroke="#78C33B" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/>
                            </svg>
                            <span>Отправить</span>
                        </button>
                        <button className="details__folder-btn edit" onClick={() => setModalDistIsOpen(true)}>
                            <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M7.08876 1.00474L0.866469 7.22594C0.626689 7.46568 0.398907 7.93317 0.350951 8.2688L0.015261 10.6422C-0.104629 11.5053 0.494815 12.1046 1.35802 11.9847L3.73182 11.6491C4.06751 11.6012 4.53511 11.3734 4.77489 11.1337L10.9972 4.91247C12.0642 3.84563 12.5797 2.599 10.9972 1.01673C9.41463 -0.577532 8.16777 -0.07408 7.08876 1.00474Z" fill="#8B98EE"/>
                                <path d="M6 2.25C6.50769 4.06154 7.92692 5.49231 9.75 6" stroke="white" strokeWidth="1.5" strokeMiterlimit="10" strokeLinecap="round" strokeLinejoin="round"/>
                            </svg>
                            <span>Редактировать</span>
                        </button>
                        <button type="button" className={"details__folder-switch-btn switch-btn" + (thread.folderDistribution ? (thread.folderDistribution.isActive ? ' active' : ' disable') : '')}/>
                        <button type="button" className="details__folder-del">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M21.0697 5.23C19.4597 5.07 17.8497 4.95 16.2297 4.86V4.85L16.0097 3.55C15.8597 2.63 15.6397 1.25 13.2997 1.25H10.6797C8.34967 1.25 8.12967 2.57 7.96967 3.54L7.75967 4.82C6.82967 4.88 5.89967 4.94 4.96967 5.03L2.92967 5.23C2.50967 5.27 2.20967 5.64 2.24967 6.05C2.28967 6.46 2.64967 6.76 3.06967 6.72L5.10967 6.52C10.3497 6 15.6297 6.2 20.9297 6.73C20.9597 6.73 20.9797 6.73 21.0097 6.73C21.3897 6.73 21.7197 6.44 21.7597 6.05C21.7897 5.64 21.4897 5.27 21.0697 5.23Z" fill="#EB376D"/>
                                <path d="M19.2317 8.14C18.9917 7.89 18.6617 7.75 18.3217 7.75H5.6817C5.3417 7.75 5.0017 7.89 4.7717 8.14C4.5417 8.39 4.4117 8.73 4.4317 9.08L5.0517 19.34C5.1617 20.86 5.3017 22.76 8.7917 22.76H15.2117C18.7017 22.76 18.8417 20.87 18.9517 19.34L19.5717 9.09C19.5917 8.73 19.4617 8.39 19.2317 8.14ZM13.6617 17.75H10.3317C9.9217 17.75 9.5817 17.41 9.5817 17C9.5817 16.59 9.9217 16.25 10.3317 16.25H13.6617C14.0717 16.25 14.4117 16.59 14.4117 17C14.4117 17.41 14.0717 17.75 13.6617 17.75ZM14.5017 13.75H9.5017C9.0917 13.75 8.7517 13.41 8.7517 13C8.7517 12.59 9.0917 12.25 9.5017 12.25H14.5017C14.9117 12.25 15.2517 12.59 15.2517 13C15.2517 13.41 14.9117 13.75 14.5017 13.75Z" fill="#EB376D"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            <ul className="details__thread-list">
                {thread.servers?.length ?
                    thread.servers.map((item) => <DetailsThreadServer thread={thread} modalConfirm={modalConfirm} alertControl={alertControl} item={item} key={item.id}/>)
                    : ''}
            </ul>

            <ModalDist isOpen={modalDistControl} data={thread.folderDistribution}/>
        </div>
    );
};

export default DetailsThread;